<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<head>
    <title>List of customers</title>
    <th:block th:replace="layout/layoutAdmin/head"/>
</head>
<body>
<div id="wrapper">
    <th:block th:replace="layout/layoutAdmin/sidebar"/>
    <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
            <!-- Topbar -->
            <th:block th:replace="layout/layoutAdmin/topbar"/>
            <!-- End of Topbar -->

            <div class="container-fluid">

                <th:block th:replace="layout/layout_home/loading"></th:block>
                <th:block th:replace="layout/layout_home/toast"></th:block>

                <!-- DataTales Example -->
                <div class="card shadow mb-4">
                    <div class="card-header py-3" style="display: flex; justify-content: space-between">
                        <h6 class="m-0 font-weight-bold text-primary">Product Management</h6>
                        <div class="button-container">
                            <a href="/products/create" class="btn btn-primary">Create new Product</a>
                            <span class="button-separator"></span>
                            <a href="/products/restore" class="btn btn-primary">Restore Product</a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Product Name</th>
                                    <th>Quantity</th>
                                    <th>Branch</th>
                                    <th>Image</th>
                                    <th>Price</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                                <!--                                    <tr>-->
                                <!--                                        <td>${product.id}</td>-->
                                <!--                                        <td>${product.productName}</td>-->
                                <!--                                        <td>${product.quantity}</td>-->
                                <!--                                        <td>${product.branchName}</td>-->
                                <!--                                        <td><img src="../images${product.urlImage}" alt=""-->
                                <!--                                                 style="width: 145px;height: 90px"></td>-->
                                <!--                                        <td>${product.price}</td>-->
                                <!--                                        <td>-->
                                <!--                                            <a href="/product?action=edit&id=${product.id}" class="btn btn-primary ">Update</a>-->
                                <!--                                            <a onclick="showConfirm(${product.id})"-->
                                <!--                                               class="btn btn-primary ">Delete</a>-->
                                <!--                                        </td>-->
                                <!--                                    </tr>-->
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Begin Page Content -->

            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <th:block th:replace="layout/layoutAdmin/footer"/>
        <!-- End of Footer -->
        <th:block th:replace="layout/layoutAdmin/modalLogout"/>
    </div>
</div>
<script>
    const page = {
        url: {
            getAllProducts: AppUtils.BASE_PRODUCTS_API,
            getProduct: AppUtils.BASE_PRODUCTS_API + "/"
        },
        elements: {},
        loadData: {},
        commands: {}
    }
    page.elements.btnBanElems = $(".ban");
    page.elements.btnEditElems = $(".edit")

    page.elements.bodyProduct = $("#dataTable tbody")
    page.elements.loading = $('#loading');
    page.commands.getAllProduct = async () => {
        return await $.ajax({
            url: page.url.getAllProducts
        });
    }
    page.commands.getProduct = async (productId) => {
        const response = await $.ajax({
            url: page.url.getProduct + productId,
            dataType: "json",
        });
        return response;
    }


    page.commands.handleClickEditButton = () => {
        const btnBanElems = page.elements.btnBanElems;
        $.each(btnBanElems, (index, item) => {
            $(item).on("click", async () => {
                const productId = $(item).data("id");
                const product = await page.commands.getProduct(productId);


                $("idEdit").val(productId)
            })
        })


    }
    page.commands.handleClickBanButton = () => {

    }


    page.commands.handleClickRow = () => {
        page.commands.handleClickEditButton();
        page.commands.handleClickBanButton();
    }

    page.loadData.renderProduct = async () => {
        const products = await page.commands.getAllProduct();
        products.forEach(item => {
            const str = page.commands.renderProduct(item);
            page.elements.bodyProduct.prepend(str)
        })
        page.commands.handleClickRow();
    }


    page.commands.renderProduct = (obj) => {
        return `
                               <td>${obj.id}</td>
                               <td>${obj.productName}</td>
                               <td>${obj.quantity}</td>
                               <td>${obj.branch}</td>
                               <td>${obj.branch}</td>
                               <td>${obj.price}</td>
                               <td>
                                   <button class="btn btn-outline-success edit" data-id="${obj.id}">
                                       <i class="fas fa-edit"></i>
                                   </button>
                                   <button class="btn btn-outline-success ban" data-id="${obj.id}">
                                       <i class="fas fa-ban"></i>
                                   </button>
                               </td>
                           </tr>
`
    }


</script>


<th:block th:replace="layout/layoutAdmin/foot"/>
</body>
</html>